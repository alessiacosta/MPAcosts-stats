---
title: "Fig.2"
format: html
---

# Library

```{r}
library(readr)
library(ggplot2)
library(rnaturalearth) # to make a world map
library(rnaturalearthdata) # data for world map with polygons of the coastline only
library(dplyr)
library(sf)
library(ggspatial) # to add spatial elements to a ggplot map
library(tidycountries) # to get country coordinates
library(tidyr)
library(patchwork)
```

# Importing data

```{r}
#upload the right data
fig1 <- read_csv("../Data/fig.1.csv")
# Get world map data
world <- ne_countries(scale = "medium", returnclass = "sf")
# Load the coastline data from rnaturalearth
coastline_data <- ne_coastline(scale = "medium", returnclass = "sf")
# importing taffied data fro requency map
frequency <- read_csv("../Data/coord.frequency.csv")
```

# Treating data

```{r}
# Tally of entries for each country 
fig1_tally <- fig1 |> 
  group_by(Country) |> 
  tally() |> 
  arrange(desc(n)) |> 
  mutate(official_name = as.character(Country))
```


# Map with both fully protected and multi-use areas

```{r}
# Combined in one plot 
combined2 <- 
  ggplot() +
  # Plot countries in a very light grey
  geom_sf(data = world, fill = "grey95", color = "black", size = 0.3) +  
  # Overlay the coastline in black
  geom_sf(data = coastline_data, color = "black", fill = NA) +  
  geom_point(data =fig1, aes(x =Longitude, y=Latitude, size = Size, fill = Protection_level, color = Protection_level), 
             shape = 21, # shape that has the circle and border
             #color = "black", # color of the border
             stroke = 0.9, # thickness of the border
             alpha = 0.7) +
  # Set coordinate system
  coord_sf() +  
  # Adjust theme
  theme_minimal() +  
  theme(  
    text = element_text(family = "serif"),  # Set font to serif
    axis.text = element_text(size = 24),  
    axis.title = element_blank(),  # Removes axis titles  
    axis.line.x = element_line(color = "black", size = 0.5),  
    axis.line.y = element_line(color = "black", size = 0.5),  
    axis.ticks = element_line(color = "black", size = 0.5),  
    panel.grid = element_blank(), 
    legend.title = element_text(size = 20), 
    legend.text = element_text(size = 16)) + # set the size of the text of the legend items
  scale_size_continuous(range = c(6, 25), 
                        limits = c(min(fig1$Size), max(fig1$Size)),  # select meaningful sizes for legend
                        breaks = c(1, 100000, 990000), # set the specific bubble sizes shown in the legend
                        labels = comma) + # add a comma to mark thousands in the bubles in teh legend
  labs(size = "MPA Size (kmÂ²)", color = "Degree of protection", fill = "Degree of protection") + # Rename the legend title to "MPA size"
  scale_fill_manual(
    values = c(
      "Fully protected area" = "#0072B2", 
      "Multi-use area" = "#E69F00")) + 
  scale_color_manual(    # changing the color of the borders for the two different categories
    values = c(
      "Fully protected area" = "#004C7A", 
      "Multi-use area" = "#B37400")) + 
  guides(color = guide_legend( override.aes = list(size=8)),  # increase the size of the legend points for protection level 
         size = guide_legend(override.aes = list(fill = "black")))  # manually changing for MPA size bubbles
# exporting the plot as a png
png("../Results/Combined2.png", width = 2500, height = 2300, res = 150)
combined2
dev.off()  
```















